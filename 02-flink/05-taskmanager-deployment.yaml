apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: flink-taskmanager
  namespace: flink
spec:
  replicas: 2
  selector:
    matchLabels:
      app: flink
      component: taskmanager
  template:
    metadata:
      labels:
        app: flink
        component: taskmanager
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9999"      
    spec:
      containers:
      - name: taskmanager
        image: wzorgdrager/flink-prometheus:0.0.1
        args:
        - taskmanager
        ports:
        - containerPort: 6121
          name: data
        - containerPort: 6122
          name: rpc
        - containerPort: 6125
          name: query
        - containerPort: 9999
          name: prom
        env:
        - name: JOB_MANAGER_RPC_ADDRESS
          value: flink-jobmanager
        volumeMounts:
        - name: config-volume
          mountPath: /opt/flink/conf
      volumes:
        - name: config-volume
          configMap:
            name: flink-config
